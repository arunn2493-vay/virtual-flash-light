<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      background-color: black;
    }
    .flash {
      animation: flash 1s infinite;
    }
    @keyframes flash {
      0%, 100% { background-color: black; }
      50% { background-color: red; }
    }
  </style>
</head>
<body>
  <script>
    console.log('Script is loaded and running');
    // Function to poll the server
let flashTimeout; // Store the timeout reference
let lastFlashState = false; // Track whether the last request triggered a flash

async function checkForFlash() {
  try {
    console.log('Polling server for updates...');

    // Fetch the server response
    const response = await fetch('https://arunn2493-vay.github.io/virtual-flash-light/index.html?flash=true');
    console.log('Polling response received:', response);

    // Parse the response URL and extract the flash parameter
    const url = new URL(response.url);
    const shouldFlash = url.searchParams.get('flash') === 'true'; // Check if flash=true
    console.log(`Flash parameter detected: ${shouldFlash}`);

    // Trigger the flash only if flash=true and lastFlashState is false
    if (shouldFlash && !lastFlashState) {
      console.log('Triggering flash animation...');
      
      // Add the flash class to the body
      document.body.classList.add('flash');

      // Set lastFlashState to true
      lastFlashState = true;

      // Clear any ongoing timeout
      if (flashTimeout) {
        clearTimeout(flashTimeout);
      }

      // Remove the flash class after 3 seconds
      flashTimeout = setTimeout(() => {
        document.body.classList.remove('flash');
        console.log('Flash animation ended');

        // Reset lastFlashState after the animation ends
        lastFlashState = false;
        console.log('lastFlashState reset to false');
      }, 3000);
    } else if (!shouldFlash) {
      // Reset lastFlashState if flash=true is no longer detected
      console.log('No flash detected; resetting lastFlashState.');
      lastFlashState = false;
    }
  } catch (error) {
    console.error('Error during polling:', error);
  }
}

// Poll every 2 seconds
setInterval(checkForFlash, 2000);


  </script>
</body>
</html>
